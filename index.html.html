<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Installation Professionals | Get Free Quotes</title>
    <meta name="description" content="Connect with top-rated solar installation professionals. Get free quotes for residential and commercial solar panel installation.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #ff7e30 0%, #ff5f00 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .buttons-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .buttons-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #ff7e30 0%, #ff5f00 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(255, 126, 48, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(255, 126, 48, 0.4);
        }
        
        .action-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .info-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        
        .info-section p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 10px 10px 0 0;
            margin-top: 40px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            background: #ff6b6b;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background: #4ecdc4;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <header>
        <div class="container">
            <h1>Solar Installation Professionals</h1>
            <p>Connect with top-rated solar installers and get free quotes for your project</p>
        </div>
    </header>
    
    <div class="container">
        <section class="buttons-section">
            <h2>Find Solar Installers Near You</h2>
            <p>Select an option below to connect with certified solar professionals:</p>
            
            <div class="action-buttons">
                <button class="action-btn" id="residentialBtn">Residential Solar</button>
                <button class="action-btn" id="commercialBtn">Commercial Solar</button>
                <button class="action-btn" id="batteryBtn">Battery Storage</button>
                <button class="action-btn" id="consultationBtn">Free Consultation</button>
            </div>
            
            <p>We'll connect you with the best local solar installers for your needs</p>
        </section>
        
        <section class="info-section">
            <h3>Why Choose Solar?</h3>
            <p>Solar energy can reduce your electricity bills, increase your property value, and help protect the environment. Our network of certified solar installers can help you find the right solution for your home or business.</p>
            
            <h3>How It Works</h3>
            <p>1. Click one of the options above to get started</p>
            <p>2. We'll connect you with top-rated solar installers in your area</p>
            <p>3. Receive free quotes and compare options</p>
            <p>4. Choose the best installer for your project</p>
        </section>
    </div>
    
    <footer>
        <div class="container">
            <p>Â© 2024 Solar Installation Professionals. All rights reserved.</p>
            <p>Contact us: info@solarinstallerpro.com</p>
        </div>
    </footer>

    <script>
        // Cloudflare Worker URL - REPLACE WITH YOUR ACTUAL WORKER URL
        const WORKER_URL = 'https://new-worker-code.shoaibsoftengr99.workers.dev/';
        
        // Show notification
        function showNotification(message, isError = true) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = isError ? '#ff6b6b' : '#4ecdc4';
            notification.className = isError ? 'notification show' : 'notification show success';
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Create a hidden iframe to establish solarinstallerpro.com as referrer
        function createReferrerFrame() {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'https://solarinstallerpro.com/referrer-establish';
            document.body.appendChild(iframe);
            return iframe;
        }
        
        // Call the Cloudflare Worker to get the redirect URL using GET method
        async function callWorker(buttonType) {
            try {
                const response = await fetch(`${WORKER_URL}/redirect?type=${buttonType}&t=${Date.now()}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Referrer-Policy': 'unsafe-url'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Worker responded with status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.redirectUrl) {
                    return data.redirectUrl;
                } else {
                    throw new Error(data.error || 'Failed to get redirect URL from worker');
                }
            } catch (error) {
                console.error('Error calling worker:', error);
                throw error;
            }
        }
        
        // Redirect using window.location to preserve referrer with GET method
        function redirectWithGet(url) {
            // Show notification
            showNotification('Connecting you with solar installers...', false);
            
            // Use setTimeout to ensure the notification is visible
            setTimeout(() => {
                window.location.href = url;
            }, 1500);
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.action-btn');
            let referrerFrame = null;
            
            // Create the referrer iframe early to establish the referrer
            setTimeout(() => {
                referrerFrame = createReferrerFrame();
            }, 1000);
            
            buttons.forEach(button => {
                button.addEventListener('click', async function() {
                    const buttonId = this.id;
                    const originalText = this.textContent;
                    
                    // Show loading state
                    this.textContent = 'Connecting...';
                    this.disabled = true;
                    
                    try {
                        // Determine button type
                        let buttonType = 'general';
                        if (buttonId === 'residentialBtn') buttonType = 'residential';
                        if (buttonId === 'commercialBtn') buttonType = 'commercial';
                        if (buttonId === 'batteryBtn') buttonType = 'battery';
                        if (buttonId === 'consultationBtn') buttonType = 'consultation';
                        
                        // Call the worker to get the redirect URL
                        const targetUrl = await callWorker(buttonType);
                        
                        // Use the redirect method that will show solarinstallerpro.com as referrer
                        redirectWithGet(targetUrl);
                    } catch (error) {
                        console.error('Redirect failed:', error);
                        this.textContent = originalText;
                        this.disabled = false;
                        
                        // Show error notification
                        showNotification('Connection failed. Please try again.');
                    }
                });
            });
        });
    </script>
</body>
</html>
